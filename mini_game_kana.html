<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Mini Game Kana</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* === BASE STYLES === */
    body { 
      background:#0f172a; 
      color:#f1f5f9; 
      font-family:sans-serif; 
      text-align:center; 
      margin:0; 
      padding:20px; 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .game-box{ 
      margin:10px auto; 
      padding:20px; 
      background:#1e293b; 
      border-radius:12px; 
      width:750px; 
      max-width:95%; 
      box-shadow:0 4px 12px rgba(0,0,0,0.4); 
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }
    h2{ 
      margin-top:0; 
      color:#facc15; 
      font-size: 6vw;
    }
    .kana{ 
      font-size:16vw; 
      margin:20px; 
      min-height:15vh; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      font-weight:bold; 
      letter-spacing:3px; 
      flex-grow: 1;
    }
    
    /* === CONTROLS & ANSWERS STYLES === */
    .controls, .switch-group { margin:15px 0; }
    .answers{ 
      display:grid; 
      grid-template-columns:repeat(2,1fr); 
      gap:10px; 
      margin-top:20px; 
      margin-bottom: 20px;
    }
    button{ 
      padding:15px;
      font-size:4vw; 
      border:none; 
      border-radius:8px; 
      cursor:pointer; 
      background:#334155; 
      color:#f1f5f9; 
      transition:all 0.25s; 
    }
    button:hover:not(:disabled){ background:#475569; transform:scale(1.05); }
    .correct{ background:#22c55e !important; color:#fff !important; }
    .wrong{ background:#ef4444 !important; color:#fff !important; }

    #stats{ margin-top:20px; font-size:4vw; }
    #status{ font-size: 5vw; font-weight: bold; margin: 10px 0; }

    /* ƒêi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc cho c√°c control */
    select.form-control, input.form-control {
      padding:6px 10px; font-size:3.5vw;
      border-radius:0.375rem;
    }
    
    /* === TOGGLE SWITCH STYLES (ƒê√É KH√îI PH·ª§C) === */
    .switch-group { 
        display:grid; 
        grid-template-columns: repeat(2, 1fr); /* Y√™u c·∫ßu 2: 2 c·ªôt tr√™n mobile */
        gap: 15px 10px; 
        justify-content:center; 
        margin:15px 0; 
    }
    .switch-container { display:flex; align-items:center; gap:6px; }
    .switch { position:relative; display:inline-block; width:46px; height:24px; }
    .switch input { opacity:0; width:0; height:0; }
    .slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:#64748b; transition:.4s; border-radius:24px; }
    .slider:before { position:absolute; content:""; height:18px; width:18px; left:3px; bottom:3px; background:white; transition:.4s; border-radius:50%; }
    input:checked + .slider { background-color:#22c55e; }
    input:checked + .slider:before { transform:translateX(22px); }
    .switch-label { font-size: 14px; color:#f1f5f9; }

    /* === MEDIA QUERY CHO M√ÄN H√åNH L·ªöN H∆†N (Desktop/Tablet) === */
    @media (min-width: 768px) {
      .game-box {
        width: 750px;
        height: auto;
        margin-top: 30px;
        max-width: 90%;
      }
      h2 { font-size: 24px; }
      .kana { font-size: 90px; min-height: 100px; }
      button { font-size: 20px; padding: 12px; }
      #stats { font-size: 18px; }
      #status { font-size: 20px; }
      select.form-control, input.form-control { font-size: 16px; }
      
      /* Tr√™n desktop, chuy·ªÉn v·ªÅ b·ªë c·ª•c ban ƒë·∫ßu (flex-wrap) */
      .switch-group { 
        display: flex;
        grid-template-columns: none;
        flex-wrap: wrap; 
        gap: 15px; 
      }
    }
  </style>
</head>
<body>
  <div class="game-box">
    <h2>Mini Game Kana</h2>
    <div class="controls">
      <label>B·∫£ng ch·ªØ: 
        <select id="mode" class="form-control">
          <option value="hiragana">Hiragana</option>
          <option value="katakana">Katakana</option>
        </select>
      </label>
      &nbsp; | &nbsp;
      <label>Ch·∫ø ƒë·ªô c√¢u h·ªèi:
        <select id="questionMode" class="form-control">
          <option value="toRoma">Ch·ªçn Romaji t·ª´ K√Ω t·ª±</option>
          <option value="toKana">Ch·ªçn K√Ω t·ª± t·ª´ Romaji</option>
        </select>
      </label>
    </div>
    <div class="switch-group" id="groupSwitches"></div>
    <div class="controls">
      <label>Th·ªùi gian suy nghƒ© m·ªói c√¢u (gi√¢y): <input type="number" id="thinkTime" value="5" min="1" class="form-control"></label>
      <button onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
      <button onclick="resetGame()">ƒê·∫∑t l·∫°i</button>
    </div>
    <div class="kana" id="kana">?</div>
    
    <p id="status">Nh·∫•n B·∫Øt ƒë·∫ßu cho c√¢u ti·∫øp theo.</p>

    <div class="answers" id="answersBox">
      <button onclick="chooseAnswer(0)" id="btn0"></button>
      <button onclick="chooseAnswer(1)" id="btn1"></button>
      <button onclick="chooseAnswer(2)" id="btn2"></button>
      <button onclick="chooseAnswer(3)" id="btn3"></button>
    </div>
    
    <div id="stats">
      ‚úÖ ƒê√∫ng: <span id="correct">0</span> | ‚ùå Sai: <span id="wrong">0</span> | üìä T·ªïng: <span id="total">0</span>
    </div>
  </div>
  <script>
    const kanaMap = {
      a:{hiragana:["„ÅÇ","„ÅÑ","„ÅÜ","„Åà","„Åä"], katakana:["„Ç¢","„Ç§","„Ç¶","„Ç®","„Ç™"], roma:["a","i","u","e","o"]},
      k:{hiragana:["„Åã","„Åç","„Åè","„Åë","„Åì"], katakana:["„Ç´","„Ç≠","„ÇØ","„Ç±","„Ç≥"], roma:["ka","ki","ku","ke","ko"]},
      s:{hiragana:["„Åï","„Åó","„Åô","„Åõ","„Åù"], katakana:["„Çµ","„Ç∑","„Çπ","„Çª","„ÇΩ"], roma:["sa","shi","su","se","so"]},
      t:{hiragana:["„Åü","„Å°","„Å§","„Å¶","„Å®"], katakana:["„Çø","„ÉÅ","„ÉÑ","„ÉÜ","„Éà"], roma:["ta","chi","tsu","te","to"]},
      n:{hiragana:["„Å™","„Å´","„Å¨","„Å≠","„ÅÆ"], katakana:["„Éä","„Éã","„Éå","„Éç","„Éé"], roma:["na","ni","nu","ne","no"]},
      h:{hiragana:["„ÅØ","„Å≤","„Åµ","„Å∏","„Åª"], katakana:["„Éè","„Éí","„Éï","„Éò","„Éõ"], roma:["ha","hi","fu","he","ho"]},
      m:{hiragana:["„Åæ","„Åø","„ÇÄ","„ÇÅ","„ÇÇ"], katakana:["„Éû","„Éü","„É†","„É°","„É¢"], roma:["ma","mi","mu","me","mo"]},
      y:{hiragana:["„ÇÑ","„ÇÜ","„Çà"], katakana:["„É§","„É¶","„É®"], roma:["ya","yu","yo"]},
      r:{hiragana:["„Çâ","„Çä","„Çã","„Çå","„Çç"], katakana:["„É©","„É™","„É´","„É¨","„É≠"], roma:["ra","ri","ru","re","ro"]},
      w:{hiragana:["„Çè","„Çí","„Çì"], katakana:["„ÉØ","„É≤","„É≥"], roma:["wa","wo","n"]}
    };

    let correct=0, wrong=0, total=0;
    let currentAnswer="";
    let timer;
    let scrambleInterval;

    const groupKeys = Object.keys(kanaMap);

    function renderGroupSwitches(){
      const container=document.getElementById("groupSwitches");
      container.innerHTML="";
      groupKeys.forEach(key=>{
        const div=document.createElement("div");
        div.className="switch-container";
        div.innerHTML=`<label class="switch"><input type="checkbox" class="groupFilter" value="${key}" checked><span class="slider"></span></label><span class="switch-label">${key}</span>`;
        container.appendChild(div);
      });
    }

    function getSelectedGroups(){
      return [...document.querySelectorAll('.groupFilter:checked')].map(cb=>cb.value);
    }

    function scrambleText(element, finalText, duration=1500, qMode="toRoma", mode="hiragana", groups=[], onComplete){
      clearInterval(scrambleInterval);
      let chars = "";
      
      groups.forEach(g => {
          if (qMode === "toRoma") {
              chars += kanaMap[g][mode].join("");
          } else {
              chars += kanaMap[g].roma.join("");
          }
      });
      
      if (qMode !== "toRoma") {
          chars = [...new Set(chars)].join('');
      }

      let elapsed=0;
      const interval=80;
      scrambleInterval=setInterval(()=>{
        let display="";
        let displayLength = 1;
        
        for(let i=0;i<displayLength;i++){
          display+=chars.charAt(Math.floor(Math.random()*chars.length));
        }
        element.textContent=display;
        
        elapsed+=interval;
        if(elapsed>=duration){
          clearInterval(scrambleInterval);
          element.textContent=finalText;
          if(onComplete) onComplete();
        }
      },interval);
    }

    function startGame(){
      clearTimeout(timer);
      
      document.querySelectorAll(".answers button").forEach(btn=>{
        btn.disabled=false;
        btn.classList.remove("correct","wrong");
        btn.textContent = ""; 
      });
      
      let mode=document.getElementById("mode").value;
      let qMode=document.getElementById("questionMode").value;
      let groups=getSelectedGroups();
      if(groups.length===0){alert("Ch·ªçn √≠t nh·∫•t 1 nh√≥m");return;}
      
      let group=groups[Math.floor(Math.random()*groups.length)];
      let idx=Math.floor(Math.random()*kanaMap[group].roma.length);
      let kanaChar=kanaMap[group][mode][idx];
      let romaChar=kanaMap[group].roma[idx];
      
      currentAnswer=(qMode==="toRoma"?romaChar:kanaChar);
      let questionDisplay=(qMode==="toRoma"?kanaChar:romaChar);
      
      const kanaElem=document.getElementById("kana");
      
      let answers=[currentAnswer];
      const allPossibleAnswers = groups.flatMap(g => 
        (qMode === "toRoma" ? kanaMap[g].roma : kanaMap[g][mode])
      ).filter(ans => ans !== currentAnswer);

      allPossibleAnswers.sort(() => Math.random() - 0.5);
      const incorrectAnswers = allPossibleAnswers.slice(0, 3);
      answers = [...answers, ...incorrectAnswers];

      answers.sort(()=>Math.random()-0.5);
      
      const onAnimationComplete = () => {
          answers.forEach((ans,i)=>{document.getElementById("btn"+i).textContent=ans;});
          document.getElementById("status").textContent="Ch·ªçn ƒë√°p √°n ƒë√∫ng!";

          timer=setTimeout(()=>{
              wrong++;
              document.getElementById("wrong").textContent=wrong;
              
              document.querySelectorAll(".answers button").forEach(btn => {
                  if (btn.textContent === currentAnswer) {
                      btn.classList.add("correct");
                  }
              });

              document.getElementById("status").textContent="‚è∞ H·∫øt gi·ªù! ƒê√°p √°n ƒë√∫ng: "+currentAnswer;
              document.querySelectorAll(".answers button").forEach(btn=>btn.disabled=true);
          }, document.getElementById("thinkTime").value*1000);
      };

      scrambleText(kanaElem, questionDisplay, 1500, qMode, mode, groups, onAnimationComplete);
      
      total++;
      document.getElementById("total").textContent=total;
      document.getElementById("status").textContent="ƒêang t·∫£i c√¢u h·ªèi...";
    }

    function chooseAnswer(i){
      clearTimeout(timer);
      let btn=document.getElementById("btn"+i);
      
      document.querySelectorAll(".answers button").forEach(b=>b.disabled=true);

      if(btn.textContent===currentAnswer){
        correct++;
        btn.classList.add("correct"); 
        document.getElementById("status").textContent="üéâ ƒê√∫ng!";
      } else {
        wrong++;
        btn.classList.add("wrong"); 
        
        document.querySelectorAll(".answers button").forEach(correctBtn => {
            if (correctBtn.textContent === currentAnswer) {
                correctBtn.classList.add("correct"); 
            }
        });
        
        document.getElementById("status").textContent=`‚ùå Sai! ƒê√°p √°n ƒë√∫ng: ${currentAnswer}`;
      }
      
      document.getElementById("correct").textContent=correct;
      document.getElementById("wrong").textContent=wrong;
    }

    function resetGame(){
      correct=wrong=total=0;
      document.getElementById("correct").textContent=0;
      document.getElementById("wrong").textContent=0;
      document.getElementById("total").textContent=0;
      document.getElementById("status").textContent="Nh·∫•n B·∫Øt ƒë·∫ßu cho c√¢u ti·∫øp theo.";
      const kanaElem=document.getElementById("kana");
      kanaElem.textContent="?";
      clearInterval(scrambleInterval);
      document.querySelectorAll(".answers button").forEach(btn=>{btn.textContent="";btn.classList.remove("correct","wrong");btn.disabled=false;});
    }

    renderGroupSwitches();
  </script>
</body>
</html>