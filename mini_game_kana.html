<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Mini Game Kana</title>
	<link rel="manifest" href="/icons/manifest.json">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="KanaGame">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* === BASE STYLES: √Åp d·ª•ng cho c·∫£ Mobile v√† Desktop === */
    body { 
      background:#0f172a; 
      color:#f1f5f9; 
      font-family:sans-serif; 
      text-align:center; 
      margin:0; 
      padding:10px; 
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-sizing: border-box;    
	overflow: hidden;
    }
    .game-box{ 
      margin:10px auto; 
      padding:15px; 
      background:#1e293b; 
      border-radius:12px; 
      width:750px; 
      max-width:100%; 
      box-shadow:0 4px 12px rgba(0,0,0,0.4); 
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
    }
    h2{ 
      margin-top:0; 
      color:#facc15; 
      font-size: 5vw; 
    }
    .kana{ 
      font-size:15vw; 
      margin:10px; 
      min-height:10vh;     
max-height: 18vh;
      display:flex; 
      align-items:center; 
      justify-content:center; 
      font-weight:bold; 
      letter-spacing:3px; 
      flex-grow: 1;
      overflow: hidden;
    }
    
    /* === CONTROL LAYOUT FIXES (MOBILE) === */
    .controls-top { 
        display: flex;
        flex-direction: column; /* 2 h√†ng ri√™ng bi·ªát cho B·∫£ng ch·ªØ & Ch·∫ø ƒë·ªô */
        gap: 8px;
        margin-bottom: 10px;
        padding: 0 5px;
    }
    .control-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 5px;
        font-size: 3.5vw;
    }
    select.form-control, input.form-control {
      padding:6px 8px; 
      font-size:3.5vw; 
      line-height:1.5; 
      color:#1e293b; 
      background-color:#fff;
      border:1px solid #ced4da; 
      border-radius:0.375rem;
      max-width: 50vw;
    }
    .control-row label {
        display: flex;
        align-items: center;
        gap: 3px;
    }
    .control-row > span { display: none; }

    /* === TIME AND BUTTONS LAYOUT (MOBILE) === */
    .time-start-controls {
        display: flex;
        flex-wrap: wrap; 
        justify-content: center;
        gap: 10px;
        margin-top: 10px;
    }
    .time-start-controls label {
        display: flex;
        align-items: center;
        font-size: 3.5vw;
        flex-shrink: 0;
    }
    .time-start-controls input.form-control {
        width: 10vw; 
        min-width: 40px;
        text-align: center;
    }
    .time-start-controls button {
        flex-basis: 40%; 
        font-size: 4vw;
        padding: 10px;
    }

    /* === TOGGLE SWITCHES LAYOUT (MOBILE 5x2 C√¢n ƒë·ªëi) === */
    #groupSwitches {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin: 10px 0;
        padding: 0 5px;
    }
    /* Grid 5 c·ªôt cho c·∫£ hai h√†ng (5-5) */
    .group-row { 
        display: grid; 
        grid-template-columns: repeat(5, 1fr); 
        gap: 8px 3px; /* Gi·∫£m kho·∫£ng c√°ch ngang */
        width: 100%;
        /* ƒë·∫£m b·∫£o row-1 v√† row-2 hi·ªÉn th·ªã grid 5 c·ªôt */
    }
    #row-3 { display: none; } /* ·∫®n row 3 kh√¥ng d√πng trong b·ªë c·ª•c 5x2 */

    .switch-container { 
      display:flex; 
      align-items:center; 
      gap:3px;
      justify-content: center;
    }
    .switch { position:relative; display:inline-block; width:40px; height:22px; }
    .switch input { opacity:0; width:0; height:0; }
    .slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background-color:#64748b; transition:.4s; border-radius:22px; }
    .slider:before { position:absolute; content:""; height:16px; width:16px; left:3px; bottom:3px; background:white; transition:.4s; border-radius:50%; }
    input:checked + .slider { background-color:#22c55e; }
    input:checked + .slider:before { transform:translateX(18px); }
    .switch-label { font-size: 3vw; color:#f1f5f9; } /* ƒêi·ªÅu ch·ªânh font nh·ªè h∆°n ƒë·ªÉ ph√π h·ª£p v·ªõi 5 c·ªôt */


    /* === ANSWERS & STATUS STYLES === */
    .answers{ 
      display:grid; 
      grid-template-columns:repeat(2,1fr); 
      gap:8px; 
      margin-top:10px; 
      margin-bottom: 10px;
    }
    /* === HO√ÄN NGUY√äN STYLE BUTTON C≈® V√Ä X√ìA HI·ªÜU ·ª®NG TRANSFORM === */
    button{ 
      padding:12px;
      font-size:4vw; /* Gi·ªØ k√≠ch th∆∞·ªõc t∆∞∆°ng ƒë·ªëi tr√™n mobile */
      border:none; 
      border-radius:8px; 
      cursor:pointer; 
      background:#334155; 
      color:#f1f5f9; 
      transition:all 0.25s; 
    }
    button:hover:not(:disabled){ 
        background:#475569; 
        /* X√≥a transform:scale(1.05) */
    }
    .correct{ background:#22c55e !important; color:#fff !important; }
    .wrong{ background:#ef4444 !important; color:#fff !important; }

    #stats{ margin-top:10px; font-size:3.5vw; }
    #status{ font-size: 4vw; font-weight: bold; margin: 5px 0; }
    
    /* === MEDIA QUERY CHO M√ÄN H√åNH L·ªöN H∆†N (Desktop/Tablet: Gi·ªØ nguy√™n layout ban ƒë·∫ßu) === */
    @media (min-width: 768px) {
      body { padding: 20px; }
      .game-box {
        width: 750px;
        padding: 20px;
      }
      h2 { font-size: 24px; }
      .kana { font-size: 90px; margin: 20px; }
      
      /* Restore Original Control Layout: 1 h√†ng */
      .controls-top {
        flex-direction: row; 
        justify-content: center;
        gap: 15px;
        margin: 15px 0;
        padding: 0;
      }
      .control-row {
        justify-content: center;
        gap: 15px;
        font-size: 16px;
      }
      .control-row > span { display: inline; } /* Hi·ªán l·∫°i d·∫•u | */
      select.form-control, input.form-control { 
          font-size: 16px; 
          max-width: none; 
          padding: 6px 12px;
      }
      
      /* Restore Original Time/Button Layout: 1 h√†ng */
      .time-start-controls {
        margin: 15px 0;
        gap: 15px;
        flex-wrap: nowrap;
      }
      .time-start-controls label { 
        font-size: 16px; 
      }
      .time-start-controls input.form-control { width: auto; min-width: 0; }
      .time-start-controls button {
        font-size: 20px; 
        padding: 12px;
        flex-basis: auto;
      }
      
      /* Buttons Desktop style */
      button { 
        font-size:20px;
        padding:12px;
      }
      button:hover:not(:disabled){ background:#475569; }

      /* Restore Original Switch Layout (Single row flex-wrap) */
      #groupSwitches {
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
        margin: 15px 0;
      }
      .group-row {
          display: flex; /* Tr·ªü l·∫°i flex cho desktop */
          grid-template-columns: none;
          gap: 15px;
      }
      #row-2, #row-3 {
        display: none; 
      }
      
      /* C·∫•u h√¨nh l·∫°i Switch tr√™n desktop */
      .switch-container { justify-content: flex-start; }
      .switch { width:46px; height:24px; }
      .slider:before { height:18px; width:18px; }
      input:checked + .slider:before { transform:translateX(22px); }
      .switch-label { font-size: 14px; }

      #stats { font-size: 18px; }
      #status { font-size: 20px; }
    }
  </style>
</head>
<body>
  <div class="game-box">
    <h2>Mini Game Kana</h2>
    
    <div class="controls">
      <div class="controls-top">
          <div class="control-row">
            <label>B·∫£ng ch·ªØ: 
              <select id="mode" class="form-control">
                <option value="hiragana">Hiragana</option>
                <option value="katakana">Katakana</option>
              </select>
            </label>
            <span>|</span>
          </div>
          <div class="control-row">
            <label>Ch·∫ø ƒë·ªô c√¢u h·ªèi:
              <select id="questionMode" class="form-control">
                <option value="toRoma">Ch·ªçn Romaji t·ª´ K√Ω t·ª±</option>
                <option value="toKana">Ch·ªçn K√Ω t·ª± t·ª´ Romaji</option>
              </select>
            </label>
          </div>
      </div>

      <div id="groupSwitches">
        </div>
      
      <div class="time-start-controls">
        <label>Th·ªùi gian suy nghƒ© m·ªói c√¢u (gi√¢y): <input type="number" id="thinkTime" value="5" min="1" class="form-control"></label>
        <button onclick="startGame()">B·∫Øt ƒë·∫ßu</button>
        <button onclick="resetGame()">ƒê·∫∑t l·∫°i</button>
      </div>
    </div>

    <div class="kana" id="kana">?</div>
    
    <p id="status">Nh·∫•n B·∫Øt ƒë·∫ßu cho c√¢u ti·∫øp theo.</p>

    <div class="answers" id="answersBox">
      <button onclick="chooseAnswer(0)" id="btn0"></button>
      <button onclick="chooseAnswer(1)" id="btn1"></button>
      <button onclick="chooseAnswer(2)" id="btn2"></button>
      <button onclick="chooseAnswer(3)" id="btn3"></button>
    </div>
    
    <div id="stats">
      ‚úÖ ƒê√∫ng: <span id="correct">0</span> | ‚ùå Sai: <span id="wrong">0</span> | üìä T·ªïng: <span id="total">0</span>
    </div>
  </div>
  <script>
    const kanaMap = {
      a:{hiragana:["„ÅÇ","„ÅÑ","„ÅÜ","„Åà","„Åä"], katakana:["„Ç¢","„Ç§","„Ç¶","„Ç®","„Ç™"], roma:["a","i","u","e","o"]},
      k:{hiragana:["„Åã","„Åç","„Åè","„Åë","„Åì"], katakana:["„Ç´","„Ç≠","„ÇØ","„Ç±","„Ç≥"], roma:["ka","ki","ku","ke","ko"]},
      s:{hiragana:["„Åï","„Åó","„Åô","„Åõ","„Åù"], katakana:["„Çµ","„Ç∑","„Çπ","„Çª","„ÇΩ"], roma:["sa","shi","su","se","so"]},
      t:{hiragana:["„Åü","„Å°","„Å§","„Å¶","„Å®"], katakana:["„Çø","„ÉÅ","„ÉÑ","„ÉÜ","„Éà"], roma:["ta","chi","tsu","te","to"]},
      n:{hiragana:["„Å™","„Å´","„Å¨","„Å≠","„ÅÆ"], katakana:["„Éä","„Éã","„Éå","„Éç","„Éé"], roma:["na","ni","nu","ne","no"]},
      h:{hiragana:["„ÅØ","„Å≤","„Åµ","„Å∏","„Åª"], katakana:["„Éè","„Éí","„Éï","„Éò","„Éõ"], roma:["ha","hi","fu","he","ho"]},
      m:{hiragana:["„Åæ","„Åø","„ÇÄ","„ÇÅ","„ÇÇ"], katakana:["„Éû","„Éü","„É†","„É°","„É¢"], roma:["ma","mi","mu","me","mo"]},
      y:{hiragana:["„ÇÑ","„ÇÜ","„Çà"], katakana:["„É§","„É¶","„É®"], roma:["ya","yu","yo"]},
      r:{hiragana:["„Çâ","„Çä","„Çã","„Çå","„Çç"], katakana:["„É©","„É™","„É´","„É¨","„É≠"], roma:["ra","ri","ru","re","ro"]},
      w:{hiragana:["„Çè","„Çí","„Çì"], katakana:["„ÉØ","„É≤","„É≥"], roma:["wa","wo","n"]}
    };

    let correct=0, wrong=0, total=0;
    let currentAnswer="";
    let timer;
    let scrambleInterval;

    const groupKeys = Object.keys(kanaMap);

    function renderGroupSwitches(){
      const container=document.getElementById("groupSwitches");
      container.innerHTML="";
      
      const rows = [
          { id: 'row-1', keys: groupKeys.slice(0, 5) },  // 5 items
          { id: 'row-2', keys: groupKeys.slice(5, 10) } // 5 items
      ];
      
      // X·ª≠ l√Ω b·ªë c·ª•c Desktop: Chuy·ªÉn t·∫•t c·∫£ v·ªÅ row-1 duy nh·∫•t (Flex-wrap)
      if (window.innerWidth >= 768) {
          const rowDiv = document.createElement("div");
          rowDiv.className = "group-row";
          rowDiv.id = 'row-1';
          
          groupKeys.forEach(key => {
              const div=document.createElement("div");
              div.className="switch-container";
              const isChecked = document.querySelector(`.groupFilter[value="${key}"]`) ? document.querySelector(`.groupFilter[value="${key}"]`).checked : true;
              div.innerHTML=`<label class="switch"><input type="checkbox" class="groupFilter" value="${key}" ${isChecked ? 'checked' : ''}><span class="slider"></span></label><span class="switch-label">${key}</span>`;
              rowDiv.appendChild(div);
          });
          container.appendChild(rowDiv);
          // ƒê·∫£m b·∫£o ch·ªâ c√≥ row-1 hi·ªÉn th·ªã tr√™n desktop
          document.getElementById('row-2')?.remove();
      } 
      // X·ª≠ l√Ω b·ªë c·ª•c Mobile: 5x2 (Grid)
      else {
          rows.forEach(rowInfo => {
              const rowDiv = document.createElement("div");
              rowDiv.className = "group-row";
              rowDiv.id = rowInfo.id;
              
              rowInfo.keys.forEach(key => {
                  const div=document.createElement("div");
                  div.className="switch-container";
                  const isChecked = document.querySelector(`.groupFilter[value="${key}"]`) ? document.querySelector(`.groupFilter[value="${key}"]`).checked : true;
                  div.innerHTML=`<label class="switch"><input type="checkbox" class="groupFilter" value="${key}" ${isChecked ? 'checked' : ''}><span class="slider"></span></label><span class="switch-label">${key}</span>`;
                  rowDiv.appendChild(div);
              });
              container.appendChild(rowDiv);
          });
          // X√≥a row-3 c≈© n·∫øu n√≥ t·ªìn t·∫°i
          document.getElementById('row-3')?.remove();
      }
    }

    function getSelectedGroups(){
      return [...document.querySelectorAll('.groupFilter:checked')].map(cb=>cb.value);
    }

    function scrambleText(element, finalText, duration=1500, qMode="toRoma", mode="hiragana", groups=[], onComplete){
      clearInterval(scrambleInterval);
      let chars = "";
      
      groups.forEach(g => {
          if (qMode === "toRoma") {
              chars += kanaMap[g][mode].join("");
          } else {
              chars += kanaMap[g].roma.join("");
          }
      });
      
      if (qMode !== "toRoma") {
          chars = [...new Set(chars)].join('');
      }

      let elapsed=0;
      const interval=80;
      scrambleInterval=setInterval(()=>{
        let display="";
        let displayLength = 1;
        
        for(let i=0;i<displayLength;i++){
          display+=chars.charAt(Math.floor(Math.random()*chars.length));
        }
        element.textContent=display;
        
        elapsed+=interval;
        if(elapsed>=duration){
          clearInterval(scrambleInterval);
          element.textContent=finalText;
          if(onComplete) onComplete();
        }
      },interval);
    }

    function startGame(){
      clearTimeout(timer);
      
      document.querySelectorAll(".answers button").forEach(btn=>{
        btn.disabled=false;
        btn.classList.remove("correct","wrong");
        btn.textContent = ""; 
      });
      
      let mode=document.getElementById("mode").value;
      let qMode=document.getElementById("questionMode").value;
      let groups=getSelectedGroups();
      if(groups.length===0){alert("Ch·ªçn √≠t nh·∫•t 1 nh√≥m");return;}
      
      let group=groups[Math.floor(Math.random()*groups.length)];
      let idx=Math.floor(Math.random()*kanaMap[group].roma.length);
      let kanaChar=kanaMap[group][mode][idx];
      let romaChar=kanaMap[group].roma[idx];
      
      currentAnswer=(qMode==="toRoma"?romaChar:kanaChar);
      let questionDisplay=(qMode==="toRoma"?kanaChar:romaChar);
      
      const kanaElem=document.getElementById("kana");
      
      let answers=[currentAnswer];
      const allPossibleAnswers = groups.flatMap(g => 
        (qMode === "toRoma" ? kanaMap[g].roma : kanaMap[g][mode])
      ).filter(ans => ans !== currentAnswer);

      allPossibleAnswers.sort(() => Math.random() - 0.5);
      const incorrectAnswers = allPossibleAnswers.slice(0, 3);
      answers = [...answers, ...incorrectAnswers];

      answers.sort(()=>Math.random()-0.5);
      
      const onAnimationComplete = () => {
          answers.forEach((ans,i)=>{document.getElementById("btn"+i).textContent=ans;});
          document.getElementById("status").textContent="Ch·ªçn ƒë√°p √°n ƒë√∫ng!";

          timer=setTimeout(()=>{
              wrong++;
              document.getElementById("wrong").textContent=wrong;
              
              document.querySelectorAll(".answers button").forEach(btn => {
                  if (btn.textContent === currentAnswer) {
                      btn.classList.add("correct");
                  }
              });

              document.getElementById("status").textContent="‚è∞ H·∫øt gi·ªù! ƒê√°p √°n ƒë√∫ng: "+currentAnswer;
              document.querySelectorAll(".answers button").forEach(btn=>btn.disabled=true);
          }, document.getElementById("thinkTime").value*1000);
      };

      scrambleText(kanaElem, questionDisplay, 1500, qMode, mode, groups, onAnimationComplete);
      
      total++;
      document.getElementById("total").textContent=total;
      document.getElementById("status").textContent="ƒêang t·∫£i c√¢u h·ªèi...";
    }

    function chooseAnswer(i){
      clearTimeout(timer);
      let btn=document.getElementById("btn"+i);
      
      document.querySelectorAll(".answers button").forEach(b=>b.disabled=true);

      if(btn.textContent===currentAnswer){
        correct++;
        btn.classList.add("correct"); 
        document.getElementById("status").textContent="üéâ ƒê√∫ng!";
      } else {
        wrong++;
        btn.classList.add("wrong"); 
        
        document.querySelectorAll(".answers button").forEach(correctBtn => {
            if (correctBtn.textContent === currentAnswer) {
                correctBtn.classList.add("correct"); 
            }
        });
        
        document.getElementById("status").textContent=`‚ùå Sai! ƒê√°p √°n ƒë√∫ng: ${currentAnswer}`;
      }
      
      document.getElementById("correct").textContent=correct;
      document.getElementById("wrong").textContent=wrong;
    }

    function resetGame(){
      correct=wrong=total=0;
      document.getElementById("correct").textContent=0;
      document.getElementById("wrong").textContent=0;
      document.getElementById("total").textContent=0;
      document.getElementById("status").textContent="Nh·∫•n B·∫Øt ƒë·∫ßu cho c√¢u ti·∫øp theo.";
      const kanaElem=document.getElementById("kana");
      kanaElem.textContent="?";
      clearInterval(scrambleInterval);
      document.querySelectorAll(".answers button").forEach(btn=>{btn.textContent="";btn.classList.remove("correct","wrong");btn.disabled=false;});
    }

    renderGroupSwitches();
    
    // Th√™m listener ƒë·ªÉ g·ªçi l·∫°i render khi resize (chuy·ªÉn ƒë·ªïi mobile/desktop)
    let resizeTimer;
    window.addEventListener('resize', () => {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(() => {
            renderGroupSwitches();
        }, 100);
    });
  </script>
</body>
</html>
